# Description: Dockerfile for the API
FROM golang:latest as build
WORKDIR /api

# Copy Go module files and download them.
COPY go.mod go.sum ./
RUN go mod download

# Copy all source code.
COPY . .

# Build the application
RUN go build -o /hyperslice

# Define ARGS and ENV
ARG BACKEND_URL
ARG FRONTEND_URL
ARG POSTGRES_HOST
ARG POSTGRES_USER
ARG POSTGRES_URL
ARG POSTGRES_PASSWORD
ARG POSTGRES_DATABASE

ENV BACKEND_URL=$BACKEND_URL
ENV FRONTEND_URL=$FRONTEND_URL
ENV POSTGRES_HOST=$POSTGRES_HOST
ENV POSTGRES_USER=$POSTGRES_USER
ENV POSTGRES_URL=$POSTGRES_URL
ENV POSTGRES_PASSWORD=$POSTGRES_PASSWORD
ENV POSTGRES_DATABASE=$POSTGRES_DATABASE

# Print URLs
RUN echo "BACKEND URL IS: ${BACKEND_URL}"
RUN echo "FRONTEND URL IS: ${FRONTEND_URL}"

EXPOSE 8080
CMD [ "/hyperslice" ]